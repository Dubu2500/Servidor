<h2>Chat en línea</h2>

<div id="loginSection">
  <p>Escribe tu nombre para entrar:</p>
  <input type="text" id="nameInput" placeholder="Tu nombre" />
  <button id="saveNameBtn">Entrar</button>
</div>

<div id="roomsSection" style="display:none;">
  <p>Hola <strong id="greetName"></strong>. Elige una sala:</p>
  <ul>
    {{#each rooms}}
      <li><a href="/chat/room/{{this}}">{{this}}</a></li>
    {{/each}}
  </ul>
  <button id="logoutBtn">Cerrar sesión</button>
</div>

<script>
  (function () {
    const loginSection = document.getElementById('loginSection');
    const roomsSection = document.getElementById('roomsSection');
    const nameInput = document.getElementById('nameInput');
    const saveNameBtn = document.getElementById('saveNameBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const greetName = document.getElementById('greetName');

    function showRooms(name) {
      loginSection.style.display = 'none';
      roomsSection.style.display = '';
      greetName.textContent = name;
    }

    function showLogin() {
      roomsSection.style.display = 'none';
      loginSection.style.display = '';
      nameInput.focus();
    }

    const stored = sessionStorage.getItem('username');
    if (stored) {
      showRooms(stored);
    } else {
      showLogin();
    }

    saveNameBtn.addEventListener('click', function () {
      const name = (nameInput.value || '').trim();
      if (!name) {
        alert('Por favor escribe tu nombre');
        return;
      }
      sessionStorage.setItem('username', name);
      showRooms(name);
    });

    nameInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        saveNameBtn.click();
      }
    });

    logoutBtn.addEventListener('click', function () {
      sessionStorage.removeItem('username');
      showLogin();
    });
  })();
</script>

